#!/bin/sh
[ "$(id -u)" -eq 0 ] || { echo "run as root"; exit 1; }
TMP=$(mktemp -d /tmp/container-XXXX); trap 'rm -rf "$TMP"' EXIT
mkdir -p "$TMP/"{bin,sbin,root,etc}
cp "${1:-$(command -v busybox)}" "$TMP/bin/busybox" || { echo "give busybox"; exit 1; }
"$TMP/bin/busybox" --install "$TMP/bin" || { echo "not valid busybox"; exit 1; }
"$TMP/bin/busybox" --install "$TMP/sbin"
touch "$TMP/etc/os-release"
echo 'root::0:0:root:/root:/bin/sh' >"$TMP/etc/passwd"
echo '::respawn:/sbin/getty -L pts/0 115200 linux' >"$TMP/etc/inittab"
systemd-nspawn -D "$TMP" --boot
